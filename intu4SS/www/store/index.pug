
extends /layout/itemLayout

block head2
    script.
        console.log('fetch data and comp')// who gets back first?
        var pro = fetchItems('/items/items.json')
        depp.define({'item-wcomp':'/wcomps/item-wcomp.js'})
        depp.require(['item-wcomp'])

block main

    p oh hi

    .cards#items

    script.
        console.log('oh hi')
        function addElement(parentEl, elName) {
            var el = document.createElement(elName)
            setTimeout(function(){
                parentEl.appendChild(el)
            },1)
            return el
        }//()

        // binding step 1:
        addE1Listener('fetchItems', onGotData)
        // binding step 2:
        function onGotData(evt) { // TODO: remove items here
            var items = evt.items.items
            console.log(items)
            depp.require(['item-wcomp'], function(){
                bind(items)
            })
        }//()

        function bind(items) {
            var parent = document.getElementById('items')
            addElement(parent,'item-wcomp')
            addElement(parent,'item-wcomp')
        }
     