
extends /layout/itemLayout

block head2
    script.
        console.log('fetch data and comp')// who gets back first?
        var pro = fetchItems('/items/items.json')
        depp.define({'item-wcomp':'/wcomps/item-wcomp.js'})
        depp.require(['item-wcomp'])

block main

    p oh hi

    .cards#items

    script.
        console.log('oh hi')

        function addElement(parentEl, elName, id) {
            var el = document.createElement(elName)
            parentEl.appendChild(el)
            return el
        }//()

        // binding step 1:
        addE1Listener('fetchItems', onGotData)
        // binding step 2:
        function onGotData(evt) { // TODO: remove items here
            var items = evt.items.items
            console.log(items)
            depp.require(['item-wcomp'], function(){
                bind(items)
            })
        }//()

        function bind(items) {
            var parent = document.getElementById('items')
 
            setAttrD1(addElement(parent,'item-wcomp', 'c1'), items[0]) 
            setAttrD1(addElement(parent,'item-wcomp', 'c2'), items[1]) 
            
        }//()
     
        function setAttrD1(el, obj) {
            var clone = JSON.parse(JSON.stringify(obj))
            el.setAttribute('data', JSON.stringify(clone))
        }//()