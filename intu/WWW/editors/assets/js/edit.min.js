// mB v6.07.25 on 2019-07-17T10:12:35.971Z
if(window.location.href.indexOf("editors/edit")>-1){function pgInit(){_initCodeMirror()}var myCodeMirror
function _initCodeMirror(e){void 0!==myCodeMirror&&myCodeMirror.toTextArea(),(myCodeMirror=CodeMirror.fromTextArea(document.querySelector("#cms1"),{mode:e||"markdown",lineNumbers:!0,tabSize:3,indentWithTabs:!1,v11iewportMargin:"Infinity",lineWrapping:!0})).setSize("100%","100%")}depp.define({codeEdit:["//cdn.jsdelivr.net/npm/codemirror@5.46.0/lib/codemirror.css","//cdn.jsdelivr.net/npm/codemirror@5.46.0/theme/solarized.css","//cdn.jsdelivr.net/npm/codemirror@5.46.0/lib/codemirror.min.js","//cdn.jsdelivr.net/npm/codemirror@5.46.0/mode/markdown/markdown.js","//cdn.jsdelivr.net/npm/codemirror@5.46.0/mode/yaml/yaml.js","//cdn.jsdelivr.net/npm/codemirror@5.46.0/mode/pug/pug.js","//cdn.jsdelivr.net/npm/codemirror@5.46.0/mode/css/css.js","//cdn.jsdelivr.net/npm/codemirror@5.46.0/keymap/sublime.js"]}),depp.require("codeEdit",pgInit),depp.require(["general"],function(){$(document).on("click",".js-view-page",function(e){$(this).hasAttribute("disabled")&&e.preventDefault()})
let e=new Posts,i=window.location.hash.substr(1)
e.showDirs().then(()=>{if(void 0!==i&&""!==i){let a=$('.blog-item:contains("'+i+'")')
$(".blog-item ul").remove(),$(".upload, .i-plusCircle").removeClass("disabled"),$(".knot").removeClass("active"),$(a).find(".knot").addClass("active"),$(".blog-item").removeClass("active"),$(a).addClass("active"),$(".btn-custom.save").attr("disabled","disabled"),$(".js-view-page").removeAttr("disabled")
let s=$(a).find("span").text()
$(".js-view-page").attr("href",t+"/"+s),0===$(a).find("ul").length?e.showSubDirs(s).then(()=>{$(".blog-item li").each(function(){let e=$(this).text()
e.includes(".md")&&$(this).addClass("md-highlight"),(e.includes(".md")||e.includes(".yaml")||e.includes(".css")||e.includes(".pug")||e.includes(".csv"))&&$(this).addClass("hover-highlight")})}):$(this).find("ul").remove()}})
let t=window.appMount
$(".js-view-page").attr("href",t),$(document).off().on("click",".blog-item",function(i){i.preventDefault(),$(".blog-item ul").remove(),$(".upload, .i-plusCircle").removeClass("disabled"),$(".knot").removeClass("active"),$(this).find(".knot").addClass("active"),$(".blog-item").removeClass("active"),$(this).addClass("active"),$(".btn-custom.save").attr("disabled","disabled"),$(".js-view-page").removeAttr("disabled")
let a=$(this).find("span").text()
window.location.hash=a,$(".js-view-page").attr("href",t+"/"+a),0===$(this).find("ul").length?e.showSubDirs(a).then(()=>{$(".blog-item li").each(function(){let e=$(this).text()
e.includes(".md")&&$(this).addClass("md-highlight"),(e.includes(".md")||e.includes(".yaml")||e.includes(".css")||e.includes(".pug")||e.includes(".csv"))&&$(this).addClass("hover-highlight")})}):$(this).find("ul").remove()}),$(document).on("click",".icono-sync",function(i){i.preventDefault(),$(".blog-item").hasClass("active")?(window.refreshActiveFolder=$(".blog-item.active").find("span").text(),window.refreshActiveFile=$(".blog-item.active li.active div").text(),$(".loader").addClass("active"),$(".blog-list-wrap").html(""),e.showDirs().then(()=>{$(".blog-list-wrap").find(".blog-item span:contains("+refreshActiveFolder+")").parents(".blog-item").addClass("active").click().find("ul li:contains("+refreshActiveFile+")").addClass("active").click(),setTimeout(function(){$(".blog-item.active ul li:contains("+refreshActiveFile+")").addClass("active").click(),$(".loader").removeClass("active")},1e3)})):($(".loader").addClass("active"),$(".blog-list-wrap").html(""),e.showDirs().then(()=>$(".loader").removeClass("active")))}),$(document).on("click",".blog-item li",function(i){i.preventDefault(),i.stopPropagation()
let t=$(this).text()
if(t.includes(".md")||t.includes("dat.yaml")||t.includes("GLO.yaml")||t.includes(".csv")||t.includes(".css")){switch(!0){case t.includes(".md"):_initCodeMirror("markdown")
break
case t.includes("dat.yaml"):case t.includes("GLO.yaml"):_initCodeMirror("yaml")
break
case t.includes(".csv"):_initCodeMirror("csv")
break
case t.includes(".css"):case t.includes(".css"):_initCodeMirror("css")
break
default:_initCodeMirror("text")}$(".blog-item li").removeClass("active"),$(this).addClass("active")
let i=$(this).parents(".blog-item").find("span").text(),a=t.replace("/","")
$(".js-file-name").text(a),e.showMd(t,i),$(".btn-custom.save").removeAttr("disabled"),$(".i-calendar").addClass("disabled"),t.includes("dat.yaml")&&$(".i-calendar").removeClass("disabled")}if($(".js-enable-pug").hasClass("js-pug-enabled")){let i=".pug"
if(t.includes(i)){_initCodeMirror("pug"),$(".blog-item li").removeClass("active"),$(this).addClass("active")
let i=$(this).parents(".blog-item").find("span").text(),a=t.replace("/","")
$(".js-file-name").text(a),e.showMd(t,i),$(".btn-custom.save").removeAttr("disabled"),$(".i-calendar").addClass("disabled")}}}),$(document).on("click",".save",function(i){i.preventDefault()
let t=$(".blog-item.active").find("li.active").text(),a=$(".blog-item.active").find("span").text(),s=myCodeMirror.getValue()
$(this).attr("disabled","disabled"),$(".loader").addClass("active"),e.saveMd(t,s,a).then(()=>{$(this).removeAttr("disabled"),$(".loader").removeClass("active"),$(".notification").removeClass("d-hide").find(".text").text("The content was successfully updated"),setTimeout(function(){$(".notification").addClass("d-hide").find(".text").text("")},2e3)}).then(()=>{e.compile(t,s,a).then(e=>{if("OK"==e){let e="Files have been built"
$('[data-js="errors"]').removeClass("toast-error d-hide").html(e),setTimeout(function(){$('[data-js="errors"]').addClass("d-hide toast-error").html("")},4e3)}else{var i=e.msg+" in "+e.filename+" at line "+e.line+"<br />"
$('[data-js="errors"]').html(i),$('[data-js="errors"]').removeClass("d-hide")}})})}),$(document).on("click",".create-post",function(e){e.preventDefault(),e.stopPropagation(),$(this).hasClass("disabled")||($("form").addClass("d-hide"),$(".post-name-wrap").removeClass("d-hide"),$(".icon-wrap i").removeClass("active"),$(".icon-wrap .create-post").addClass("active"))}),$(window).click(function(){$(".post-name-wrap").addClass("d-hide")}),$(".post-name-wrap").click(function(e){e.stopPropagation()}),$(".post-name-wrap").on("submit",function(i){i.preventDefault()
let t=$(this).find("input").val(),a=$(".blog-item.active").find("span").text()
""===a?($(".notification").removeClass("d-hide").addClass("error-msg").find(".text").text("Please select a page to copy"),setTimeout(function(){$(".notification").addClass("d-hide").removeClass("error-msg").find(".text").text("")},4e3)):""===t?($(".notification").removeClass("d-hide").addClass("error-msg").find(".text").text("Page name can't be blank"),setTimeout(function(){$(".notification").addClass("d-hide").removeClass("error-msg").find(".text").text("")},4e3)):($(this).attr("disabled","disabled"),$(".loader").addClass("active"),e.addPost(t,a).then(()=>{$(this).removeAttr("disabled"),$(".loader").removeClass("active"),$(".notification").removeClass("d-hide").find(".text").text("New post was added, now you can edit the content"),setTimeout(function(){$(".notification").addClass("d-hide").find(".text").text("")},4e3),$(".post-name-wrap").addClass("d-hide").find("input").val(""),$(".create-post").removeClass("active")}),$(".blog-list-wrap").html(""),e.showDirs().then(()=>{$(".blog-list-wrap").find(".blog-item span:contains("+t+")").parents(".blog-item").addClass("active").click().find("ul li:contains('.md')").addClass("active").click(),setTimeout(function(){$(".blog-item.active ul li:contains('.md')").addClass("active").click()},1e3)}))}),$(document).on("click",".upload",function(e){e.preventDefault(),e.stopPropagation(),$(this).hasClass("disabled")||($("form").addClass("d-hide"),$(".file-upload").removeClass("d-hide"),$(".icon-wrap i").removeClass("active"),$(".icon-wrap .upload").addClass("active"),window.pathPrefixUpload=$(".blog-item.active").find("span").text())}),$(window).click(function(){$(".file-upload").addClass("d-hide"),$(".icon-wrap i").removeClass("active")}),$(".file-upload").click(function(e){e.stopPropagation()}),$("#file-upload").on("submit",function(i){i.preventDefault(),$(this).attr("disabled","disabled"),$(".loader").addClass("active")
let t=$("#file-upload-input")[0].files[0]
e.uploadFile(t,pathPrefixUpload).then(()=>{$(this).removeAttr("disabled"),$(".loader").removeClass("active"),$(".file-upload").addClass("d-hide"),$(".notification").removeClass("d-hide").find(".text").text("The file was successfully uploaded to the folder "+pathPrefixUpload),setTimeout(function(){$(".notification").addClass("d-hide").find(".text").text(""),$('.file-upload input[type="file"]').val("")},4e3)}),window.uploadActiveFile=$(".blog-item.active li.active div").text(),$(".blog-list-wrap").html(""),e.showDirs().then(()=>{$(".blog-list-wrap").find(".blog-item span:contains("+pathPrefixUpload+")").parents(".blog-item").addClass("active").click().find("ul li:contains("+uploadActiveFile+")").addClass("active").click(),setTimeout(function(){$(".blog-item.active ul li:contains("+uploadActiveFile+")").addClass("active").click()},1e3),myCodeMirror.setValue("")})}),$(document).on("click",".publish-date",function(e){e.preventDefault(),e.stopPropagation(),$(this).hasClass("disabled")||($(".icon-wrap i").removeClass("active"),$(".icon-wrap .i-calendar").addClass("active"),$("form").addClass("d-hide"),$(".publish-date-form").removeClass("d-hide"),window.pathPrefixPdate=$(".blog-item.active").find("span").text())}),$(window).click(function(){$(".publish-date-form").addClass("d-hide")}),$(document).on("click",".publish-date-form, .Zebra_DatePicker",function(e){e.stopPropagation()}),$(".publish-date-form").on("submit",function(i){i.preventDefault()
let t=$(".publish-date-form input").val()
if(""===pathPrefixPdate)$(".notification").removeClass("d-hide").addClass("error-msg").find(".text").text("Please select post on the left to set publish date"),setTimeout(function(){$(".notification").addClass("d-hide").find(".text").text(""),$(".publish-date-form input").val("")},4e3)
else if(""!==t){$(this).find("button").attr("disabled","disabled"),$(".loader").addClass("active")
let i=new Date(t).getTime()/1e3
e.setPublishDate(i,pathPrefixPdate).then(()=>{$(this).find("button").removeAttr("disabled"),$(".loader").removeClass("active"),$(".publish-date-form").addClass("d-hide"),$(".notification").removeClass("d-hide").find(".text").text("Publish date was successfully set for post "+pathPrefixPdate),setTimeout(function(){$(".notification").addClass("d-hide").find(".text").text("")},4e3)}),$(".blog-list-wrap").html(""),e.showDirs().then(()=>{$(".blog-list-wrap").find(".blog-item span:contains("+pathPrefixPdate+")").parents(".blog-item").addClass("active").click().find("ul li:contains('.md')").addClass("active").click(),setTimeout(function(){$(".blog-item.active ul li:contains('dat.yaml')").addClass("active").click()},1e3),myCodeMirror.setValue("")})}}),$(document).on("click",".js-enable-pug",function(i){i.preventDefault(),$(this).toggleClass("js-pug-enabled"),$(".easter-pug").toggleClass("active"),e.MbakeVersion()})})}