// mB v7.14.0 on 2020-02-07T15:50:12.847Z
var myCodeMirror=null,editViewModel=null
function loadTextarea(){depp.require("codeEdit",pgInit)}function pgInit(){_initCodeMirror()}function _initCodeMirror(e){null!==window.myCodeMirror&&window.myCodeMirror.toTextArea(),window.myCodeMirror=CodeMirror.fromTextArea(document.querySelector("#edit1"),{mode:e||"markdown",lineNumbers:!0,tabSize:3,indentWithTabs:!1,v11iewportMargin:"Infinity",lineWrapping:!0}),window.myCodeMirror.setSize("100%","100%")}function showDirs(e,i){let t=""
return i.getDirsList().then(e=>{Array.isArray(e)?(e.forEach(e=>{t+='<div class="blog-item"><i class="knot"><div></div></i><div class="d-flex"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 26 26" version="1.1" width="20px" height="20px"><g id="surface1"><path style=" " d="M 3 2 C 1.34375 2 0 3.34375 0 5 L 0 22 C 0 23.65625 1.34375 25 3 25 L 23 25 C 24.65625 25 26 23.65625 26 22 L 26 8 C 26 6.34375 24.65625 5 23 5 L 11 5 C 11 3.34375 9.65625 2 8 2 Z M 3 7 L 23 7 C 23.550781 7 24 7.449219 24 8 L 24 22 C 24 22.550781 23.550781 23 23 23 L 3 23 C 2.449219 23 2 22.550781 2 22 L 2 8 C 2 7.449219 2.449219 7 3 7 Z "/></g></svg><span>'+e+"</span></div></div>"}),$(".blog-list-wrap").append(t)):window.location="/edit"})}function init(e,i){showDirs(e,i).then(()=>{if(void 0!==e&&""!==e){let t=$('.blog-item:contains("'+e+'")')
$(".blog-item ul").remove(),$(".upload, .i-plusCircle").removeClass("disabled"),$(".knot").removeClass("active"),$(t).find(".knot").addClass("active"),$(".blog-item").removeClass("active"),$(t).addClass("active"),$(".btn-custom.save").attr("disabled","disabled"),$(".js-view-page").removeAttr("disabled")
let a=$(t).find("span").text()
$(".js-view-page").attr("href",appMount+"/"+a),0===$(t).find("ul").length?showSubDirs(a,i):$(this).find("ul").remove()}})}function showSubDirs(e,i){let t=""
return i.getSubDirsList(e).then(e=>{Array.isArray(e)?(e.forEach(e=>{t+='<li><div><i class="i-file"></i>'+e+"</div></li>"}),$(".blog-item.active").append("<ul>"+t+"</ul>")):window.location="/edit"}).then(()=>{$(".blog-item li").each((function(){let e=$(this).text()
e.includes(".md")&&$(this).addClass("md-highlight"),(e.includes(".md")||e.includes(".yaml")||e.includes(".css")||e.includes(".pug")||e.includes(".csv"))&&$(this).addClass("hover-highlight")}))})}function showMd(e,i){editViewModel.getFile(e,i).then(e=>{e?window.myCodeMirror.setValue(e):window.location="/edit"})}function saveMd(e,i,t,a,s){return s.saveFile(e,i,t).then(e=>e).then(()=>{a.removeAttr("disabled"),$(".loader").removeClass("active"),$(".notification").removeClass("d-hide").find(".text").text("The content was successfully updated"),setTimeout((function(){$(".notification").addClass("d-hide").find(".text").text("")}),2e3)}).then(()=>{compile(e,i,t).then(e=>{if("OK"==e){let e="Files have been built"
$('[data-js="errors"]').removeClass("toast-error d-hide").html(e),setTimeout((function(){$('[data-js="errors"]').addClass("d-hide toast-error").html("")}),3e3)}else{var i=e.msg+" in "+e.filename+" at line "+e.line+"<br />"
$('[data-js="errors"]').html(i),$('[data-js="errors"]').removeClass("d-hide")}})})}function compile(e,i,t){return editViewModel.mbakeCompile(e,i,t).then(e=>e)}function addPost(e,i,t){return editViewModel.clonePage(e,i).then(()=>{t.removeAttr("disabled"),$(".loader").removeClass("active"),$(".notification").removeClass("d-hide").find(".text").text("New post was added, now you can edit the content"),setTimeout((function(){$(".notification").addClass("d-hide").find(".text").text("")}),3e3),$(".post-name-wrap").addClass("d-hide").find("input").val(""),$(".create-post").removeClass("active")})}function uploadFile(e,i,t,a){var s=new FormData
return s.append("sampleFile",e),editViewModel.upload(s,i).then(()=>{t.removeAttr("disabled"),$(".loader").removeClass("active"),$(".file-upload").addClass("d-hide"),$(".notification").removeClass("d-hide").find(".text").text("The file was successfully uploaded to the folder "+a),setTimeout((function(){$(".notification").addClass("d-hide").find(".text").text(""),$('.file-upload input[type="file"]').val("")}),3e3)})}function setPublishDate(e,i){return editViewModel.setPublishDate(e,i).then(()=>{$(this).find("button").removeAttr("disabled"),$(".loader").removeClass("active"),$(".publish-date-form").addClass("d-hide"),$(".notification").removeClass("d-hide").find(".text").text("Publish date was successfully set for post "+i),setTimeout((function(){$(".notification").addClass("d-hide").find(".text").text("")}),3e3)})}function refresh(e,i,t){showDirs("",t).then(()=>{$(".blog-list-wrap").find(".blog-item span:contains("+e+")").parents(".blog-item").addClass("active").click().find("ul li:contains("+i+")").addClass("active").click(),setTimeout((function(){$(".blog-item.active ul li:contains("+i+")").addClass("active").click(),$(".loader").removeClass("active")}),1e3)})}function refreshClosed(e){showDirs("",e).then(()=>$(".loader").removeClass("active"))}function refreshTextarea(e,i,t){switch(!0){case e.includes(".md"):_initCodeMirror("markdown")
break
case e.includes(".yaml"):_initCodeMirror("yaml")
break
case e.includes(".csv"):_initCodeMirror("csv")
break
case e.includes(".css"):case e.includes(".css"):_initCodeMirror("css")
break
case e.includes(".pug"):_initCodeMirror("pug")
break
default:_initCodeMirror("text")}$(".blog-item li").removeClass("active"),i.addClass("active")
let a=i.parents(".blog-item").find("span").text(),s=e.replace("/","")
$(".js-file-name").text(s),showMd(e,a,t),$(".btn-custom.save").removeAttr("disabled"),$(".i-calendar").addClass("disabled"),e.includes(".yaml")&&$(".i-calendar").removeClass("disabled")}function refreshDirsOnClone(e,i){showDirs("",i).then(()=>{$(".blog-list-wrap").find(".blog-item span:contains("+e+")").parents(".blog-item").addClass("active").click().find("ul li:contains('.md')").addClass("active").click(),setTimeout((function(){$(".blog-item.active ul li:contains('.md')").addClass("active").click()}),1e3)})}function refreshOnUpload(e,i,t){showDirs("",t).then(()=>{$(".blog-list-wrap").find(".blog-item span:contains("+e+")").parents(".blog-item").addClass("active").click().find("ul li:contains("+i+")").addClass("active").click(),setTimeout((function(){$(".blog-item.active ul li:contains("+i+")").addClass("active").click()}),1e3),window.myCodeMirror.setValue("")})}function refreshOnSetDate(e){showDirs("",editViewModel).then(()=>{$(".blog-list-wrap").find(".blog-item span:contains("+e+")").parents(".blog-item").addClass("active").click().find("ul li:contains('.md')").addClass("active").click(),setTimeout((function(){$(".blog-item.active ul li:contains('dat.yaml')").addClass("active").click()}),1e3),window.myCodeMirror.setValue("")})}function signOut(){sessionStorage.clear(),window.location="/edit"}depp.require(["ui","fileUpload","editViewModel","DOMDelayed"],(async function(){addEventListener("POP-CUSTEL",(function(e){const i=e.detail
var t=window.myCodeMirror.getValue()
window.myCodeMirror.setValue(t+i)})),editViewModel=await EditViewModel.inst(),function initUpload(){const e=Uppy.Core({debug:!0,autoProceed:!1,restrictions:{maxFileSize:1e6,maxNumberOfFiles:3,minNumberOfFiles:1,allowedFileTypes:["image/*","video/*"]}}).use(Uppy.Dashboard,{trigger:".uppy-modal-opener-btn",metaFields:[{id:"name",name:"Name",placeholder:"file name"},{id:"caption",name:"Caption",placeholder:"describe what the image is about"}],browserBackButtonClose:!0}).use(Uppy.XHRUpload,{endpoint:"/upload",formData:!0,fieldName:"sampleFile"})
e.on("file-added",i=>{e.setMeta({targetDir:"/"+$(".blog-item.active").find("span").text()})}),e.on("complete",e=>{})}(),$(document).on("click",".js-view-page",(function(e){$(this).hasAttribute("disabled")&&e.preventDefault()}))
let e=window.location.hash.substr(1)
loadTextarea(),init(e,editViewModel),$(".js-view-page").attr("href",appMount),$(document).off().on("click",".blog-item",(function(e){e.preventDefault(),$(".blog-item ul").remove(),$(".upload, .i-plusCircle").removeClass("disabled"),$(".knot").removeClass("active"),$(this).find(".knot").addClass("active"),$(".blog-item").removeClass("active"),$(this).addClass("active"),$(".btn-custom.save").attr("disabled","disabled"),$(".js-view-page").removeAttr("disabled")
let i=$(this).find("span").text()
window.location.hash=i,$(".js-view-page").attr("href",appMount+"/"+i),0===$(this).find("ul").length?showSubDirs(i,editViewModel):$(this).find("ul").remove()})),$(document).on("click",".icono-sync",(function(e){if(e.preventDefault(),$(".blog-item").hasClass("active")){let e=$(".blog-item.active").find("span").text(),i=$(".blog-item.active li.active div").text()
$(".loader").addClass("active"),$(".blog-list-wrap").html(""),refresh(e,i,editViewModel)}else $(".loader").addClass("active"),$(".blog-list-wrap").html(""),refreshClosed(editViewModel)})),$(document).on("click",".blog-item li",(function(e){e.preventDefault(),e.stopPropagation()
let i=$(this)
refreshTextarea($(this).text(),i,editViewModel)})),$(document).on("click",".save",(function(e){e.preventDefault()
let i=$(".blog-item.active").find("li.active").text(),t=$(".blog-item.active").find("span").text(),a=myCodeMirror.getValue()
$(this).attr("disabled","disabled"),$(".loader").addClass("active"),saveMd(i,a,t,$(this),editViewModel)})),$(document).on("click",".create-post",(function(e){e.preventDefault(),e.stopPropagation(),$(this).hasClass("disabled")||($("form").addClass("d-hide"),$(".post-name-wrap").removeClass("d-hide"),$(".icon-wrap i").removeClass("active"),$(".icon-wrap .create-post").addClass("active"))})),$(window).click((function(){$(".post-name-wrap").addClass("d-hide")})),$(".post-name-wrap").click((function(e){e.stopPropagation()})),$(".post-name-wrap").on("submit",(function(e){e.preventDefault()
let i=$(this).find("input").val(),t=$(".blog-item.active").find("span").text()
if(""===t)$(".notification").removeClass("d-hide").addClass("error-msg").find(".text").text("Please select a page to copy"),setTimeout((function(){$(".notification").addClass("d-hide").removeClass("error-msg").find(".text").text("")}),4e3)
else if(""===i)$(".notification").removeClass("d-hide").addClass("error-msg").find(".text").text("Page name can't be blank"),setTimeout((function(){$(".notification").addClass("d-hide").removeClass("error-msg").find(".text").text("")}),4e3)
else{$(this).attr("disabled","disabled"),$(".loader").addClass("active"),addPost(i,t,$(this),editViewModel),$(".blog-list-wrap").html(""),refreshDirsOnClone(i,editViewModel)}})),$(document).on("click",".publish-date",(function(e){e.preventDefault(),e.stopPropagation(),$(this).hasClass("disabled")||($(".icon-wrap i").removeClass("active"),$(".icon-wrap .i-calendar").addClass("active"),$("form").addClass("d-hide"),$(".publish-date-form").removeClass("d-hide"),window.pathPrefixPdate=$(".blog-item.active").find("span").text(),0===window.pathPrefixPdate&&0!==$(".blog-item.active").length&&"dat.yaml"===$(".blog-item.active li.active").text&&(window.pathPrefixPdate="/"))})),$(window).click((function(){$(".publish-date-form").addClass("d-hide")})),$(document).on("click",".publish-date-form, .Zebra_DatePicker",(function(e){e.stopPropagation()})),$(".publish-date-form").on("submit",(function(e){e.preventDefault()
let i=$(".publish-date-form input").val()
if(""!==pathPrefixPdate||$(".blog-item").hasClass("active")){if(""===pathPrefixPdate&&$(".blog-item").hasClass("active")&&(pathPrefixPdate="/"),""!==i){$(this).find("button").attr("disabled","disabled"),$(".loader").addClass("active"),setPublishDate(new Date(i).getTime()/1e3,pathPrefixPdate,editViewModel),$(".blog-list-wrap").html(""),refreshOnSetDate(pathPrefixPdate,editViewModel)}}else $(".notification").removeClass("d-hide").addClass("error-msg").find(".text").text("Please select post on the left to set publish date"),setTimeout((function(){$(".notification").addClass("d-hide").find(".text").text(""),$(".publish-date-form input").val("")}),4e3)})),$(".sign-out").on("click",(function(e){e.preventDefault(),signOut()}))}))