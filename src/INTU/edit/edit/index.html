<!DOCTYPE html>
<html>
  <head>
    <script>var _start = Date.now()</script>
    <title></title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="//cdn.jsdelivr.net/npm/johnnydepp@0.1.0/dist/depp.min.js"></script>
    <script src="//cdn.jsdelivr.net/npm/riot@3.13.2/riot.min.js"></script>
    <style>
      .delayShowing { opacity: 0; }
      .blur { -webkit-filter:blur(2px);filter:blur(2px); }
    </style>
    <script src="https://cdn.jsdelivr.net/gh/intuition-dev/toolBelt@v1.8.23/toolBelt/toolBelt.min.js"></script>
    <script></script>
    <script>
      window.apiPort = location.port
      window.apiProtocol = location.protocol.split(':')[0];
      window.apiHost = location.hostname;
      
      window.appMount = window.location.origin;
      window.siteName = 'MetaBake';
      
    </script>
    <link rel="stylesheet" href="/edit/assets/css/spectreTop.css">
  </head>
  <body>
    <script src="/edit/assets/js/loader.js"></script>
    <header>
      <div class="col-settings container">
        <div>
          <div class="site-brand">Site Name</div>
        </div>
        <ul class="user-area">
          <li><a class="sign-out" href="#" id="sign-out">Sign out </a></li>
          <li class="user-name"></li>
        </ul>
      </div>
    </header>
    <div class="loader lds-css ng-scope">
      <div class="text">Deploying</div>
      <div class="lds-ellipsis" style="width:100%;height:100%">
        <div>
          <div></div>
        </div>
        <div>
          <div></div>
        </div>
        <div>
          <div></div>
        </div>
        <div>
          <div></div>
        </div>
        <div>
          <div></div>
        </div>
      </div>
    </div>
    <div class="page-content container edit-blog-page">
      <div class="columns">
        <div class="col-sidebar">
          <div class="blog-list">
            <div class="blog-list__inside">
              <div class="blog-list-wrap"></div>
            </div>
          </div>
          <div class="logo-wrap">
            <div class="logo js-enable-pug">Your Logo Here</div>
          </div>
        </div>
        <div class="col-editor">
          <div class="editor-wrapper">
            <h1>Editing  <span class="js-file-name">Choose file to edit</span></h1>
            <div class="icons-row">
              <div class="icon-wrap"><i class="upload disabled" title="file upload"></i></div>
              <div class="icon-wrap"> <i class="i-calendar disabled publish-date" title="Set publish date"></i></div>
              <div class="icon-wrap"><i class="icono-sync" title="Refresh"></i></div>
              <div class="icon-wrap"><i class="i-plusCircle disabled create-post" title="Clone page"></i></div>
            </div>
            <textarea id="cms1" rows="400"></textarea>
            <div class="errors d-hide toast toast-error mt-2" data-js="errors"></div>
            <div class="btns-wrap">
              <button class="save btn-custom btn-primary" href="#" disabled="disabled">save</button><a class="js-view-page btn-custom btn-secondary" href="#" target="_blank" disabled="disabled"><span>view page</span></a>
            </div>
          </div>
        </div>
      </div>
      <div class="notification d-hide">
        <div class="text"></div>
      </div>
      <form class="post-name-wrap d-hide">
        <label>Enter new page name:</label>
        <div class="input-wrap">
          <input name="post-name" type="text" required>
          <button type="submit"><i class="icono-checkCircle"></i></button>
        </div>
      </form>
      <form class="file-upload dropzone d-hide" action="upload" method="post" encType="multipart/form-data" id="file-upload">Select file:
        <input class="file-upload-input" id="file-upload-input" type="file" name="sampleFile" multiple="">
        <input type="submit">
      </form>
      <form class="publish-date-form d-hide">
        <label>Select date:</label>
        <div class="input-wrap">
          <input class="publish-date-input datepicker" type="text">
          <button type="submit"><i class="icono-checkCircle"></i></button>
        </div>
      </form>
    </div>
    <script>
      var myCodeMirror = null;
      depp.require(['general'], function() {
      
          $(document).on('click', '.js-view-page', function(e) {
      
              if ($(this).hasAttribute('disabled')) {
                  e.preventDefault();
              }
      
          });
      
          let posts = new Posts();
          let hash = window.location.hash.substr(1);
      
          posts.loadTextarea();
          posts.init(hash);
          
          $('.js-view-page').attr('href', appMount);
      
          // show sub directories
          $(document).off().on('click', '.blog-item', function(e) {
      
              e.preventDefault();
              $('.blog-item ul').remove();
              $('.upload, .i-plusCircle').removeClass('disabled');
              $('.knot').removeClass('active');
              $(this).find('.knot').addClass('active');
              $('.blog-item').removeClass('active');
              $(this).addClass('active');
              $('.btn-custom.save').attr("disabled", "disabled");
              $('.js-view-page').removeAttr("disabled");
      
              let postId = $(this).find('span').text();
              window.location.hash = postId;
      
              $('.js-view-page').attr('href', appMount + '/' + postId);
      
              if ($(this).find('ul').length === 0) {
                  posts.showSubDirs(postId);
              } else {
                  $(this).find('ul').remove();
              }
      
          });
      
          // Refresh directiories
          $(document).on('click', '.icono-sync', function(e) {
              e.preventDefault();
      
              if ($('.blog-item').hasClass('active')) {
      
                  let dirActive = $('.blog-item.active').find('span').text();
                  let fileActive = $('.blog-item.active li.active div').text();
                  $('.loader').addClass('active');
                  $('.blog-list-wrap').html('');
      
                  // refresh dirs
                  posts.refresh(dirActive, fileActive);
      
              } else {
      
                  // re-render dirs
                  $('.loader').addClass('active');
                  $('.blog-list-wrap').html('');
                  posts.refreshClosed();
      
              }
          });
      
          // show file contents
          $(document).on('click', '.blog-item li', function(e) {
              e.preventDefault();
              e.stopPropagation(); // prevent child trigger click on parent
      
              let target = $(this);
              let postId = $(this).text();
              posts.refreshTextarea(postId, target);
      
          });
      
          // save file
          $(document).on('click', '.save', function(e) {
              e.preventDefault();
              let postId = $('.blog-item.active').find('li.active').text();
              let pathPrefix = $('.blog-item.active').find('span').text();
              let md = myCodeMirror.getValue();
              $(this).attr("disabled", "disabled");
              $('.loader').addClass('active');
              let target = $(this);
      
              posts.saveMd(postId, md, pathPrefix, target);
      
          });
      
          // clone page
      
          // form show/hide
          $(document).on('click', '.create-post', function(e) {
              e.preventDefault();
              e.stopPropagation();
      
              if (!($(this).hasClass('disabled'))) {
                  $('form').addClass('d-hide');
                  $('.post-name-wrap').removeClass('d-hide');
                  $('.icon-wrap i').removeClass('active');
                  $('.icon-wrap .create-post').addClass('active');
              }
      
          });
      
          $(window).click(function() {
              $('.post-name-wrap').addClass('d-hide');
          });
      
          $('.post-name-wrap').click(function(event) {
              event.stopPropagation();
          });
      
          // clone page form submit
          $('.post-name-wrap').on('submit', function(e) {
      
              e.preventDefault();
      
              let postId = $(this).find('input').val();
              let pathPrefix = $('.blog-item.active').find('span').text();
      
      
              if (pathPrefix === '') {
      
                  $('.notification').removeClass('d-hide').addClass('error-msg').find('.text').text('Please select a page to copy');
      
                  setTimeout(function() {
                      $('.notification').addClass('d-hide').removeClass('error-msg').find('.text').text('');
                  }, 4000);
      
              } else if (postId === '') {
      
                  $('.notification').removeClass('d-hide').addClass('error-msg').find('.text').text('Page name can\'t be blank');
      
                  setTimeout(function() {
                      $('.notification').addClass('d-hide').removeClass('error-msg').find('.text').text('');
                  }, 4000);
      
              } else {
      
                  $(this).attr("disabled", "disabled");
                  $('.loader').addClass('active');
                  let target = $(this);
      
                  // add cloned post
                  posts.addPost(postId, pathPrefix, target)
      
                  // refresh dirs
                  $('.blog-list-wrap').html('');
      
                  posts.refreshDirsOnClone(postId);
                      
              }
      
          });
      
          /* File upload */
      
          // toggle form
          $(document).on('click', '.upload', function(e) {
              e.preventDefault();
              e.stopPropagation();
      
              if (!($(this).hasClass('disabled'))) {
      
                  $('form').addClass('d-hide');
                  $('.file-upload').removeClass('d-hide');
                  $('.icon-wrap i').removeClass('active');
                  $('.icon-wrap .upload').addClass('active');
      
                  window.pathPrefixUpload = $('.blog-item.active').find('span').text();
      
              }
      
          });
          $(window).click(function() {
              $('.file-upload').addClass('d-hide');
              $('.icon-wrap i').removeClass('active');
          });
          $('.file-upload').click(function(event) {
              event.stopPropagation();
          });
      
          // upload
          $('#file-upload').on('submit', function(e) {
              e.preventDefault();
              $(this).attr("disabled", "disabled");
              $('.loader').addClass('active');
              let input = $('#file-upload-input')[0].files[0];
              let target = $(this);
      
              posts.uploadFile(input, pathPrefixUpload, target, window.pathPrefixUpload)
                  
              // refresh dirs
              let activeFile = $('.blog-item.active li.active div').text();
              $('.blog-list-wrap').html('');
              posts.refreshOnUpload(window.pathPrefixUpload, activeFile);
      
          });
      
          /* Set publish date */
      
          // toggle form
          $(document).on('click', '.publish-date', function(e) {
              e.preventDefault();
              e.stopPropagation();
      
              if (!($(this).hasClass('disabled'))) {
                  $('.icon-wrap i').removeClass('active');
                  $('.icon-wrap .i-calendar').addClass('active');
                  $('form').addClass('d-hide');
                  $('.publish-date-form').removeClass('d-hide');
                  window.pathPrefixPdate = $('.blog-item.active').find('span').text();
                  if (window.pathPrefixPdate === '') {
                      window.pathPrefixPdate = '/'
                  }
              }
      
          });
          $(window).click(function() {
              $('.publish-date-form').addClass('d-hide');
          });
          $(document).on('click', '.publish-date-form, .Zebra_DatePicker', function(event) {
              event.stopPropagation();
          });
      
          // set date
          $('.publish-date-form').on('submit', function(e) {
              e.preventDefault();
              let publishDate = $('.publish-date-form input').val();
              if (pathPrefixPdate === '') {
      
                  $('.notification').removeClass('d-hide').addClass('error-msg').find('.text').text('Please select post on the left to set publish date');
      
                  setTimeout(function() {
                      $('.notification').addClass('d-hide').find('.text').text('');
                      $('.publish-date-form input').val('');
                  }, 4000);
      
              } else {
      
                  if (publishDate !== '') {
      
                      $(this).find('button').attr("disabled", "disabled");
                      $('.loader').addClass('active');
      
                      // convert human readable date to epoch
                      let myDate = new Date(publishDate);
                      let myEpoch = myDate.getTime() / 1000.0;
      
                      posts.setPublishDate(myEpoch, pathPrefixPdate);
      
                      // refresh dirs
                      $('.blog-list-wrap').html('');
      
                      posts.refreshOnSetDate(pathPrefixPdate);
      
                  }
      
              }
      
          });
      
          $('.sign-out').on('click', function (e) {
              e.preventDefault();
              posts.signOut();
          });
      
      });
    </script>
  <!-- mB v6.08.9 on 2019-08-23T15:21:23.126Z --></body>
</html>