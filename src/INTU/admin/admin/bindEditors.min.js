// mB v8.2.5 on 2020-02-25T00:42:29.248Z
depp.define({adminViewModel:['../models/AdminViewModel.js']}),depp.require('adminViewModel'),depp.require(['ui','scripts','setup-page'],(async function(){var adminViewModel=await AdminViewModel.inst();!function drawTable(adminViewModel){adminViewModel.getEditorsList().then(editors=>{this.table=new Tabulator("#editors-table",{layout:"fitColumns",columns:[{title:"id",field:"id",visible:!1},{title:"Email",field:"email",align:"left"},{title:"Name",field:"name",align:"left"}],rowClick:(e,row)=>{this.activeRow=row;row=row.getData();window.rowUid=row.id,$('input[name="name"]').val(row.name),$('input[name="email"], input[name="password"]').val('')}}),Array.isArray(editors)?this.table.setData(editors):window.location='/admin'}).then(this.initActionButtons)}(adminViewModel),$(document).on('click','#add-editor',(function(e){e.preventDefault(),$(this).attr("disabled","disabled"),$('.loader').addClass('active'),save('',adminViewModel).then(()=>{$(this).removeAttr("disabled"),$('.loader').removeClass('active')})})),$(document).find('#edit-editor').on('click',(function(e){e.preventDefault(),'undefined'!=typeof rowUid&&''!==rowUid?($(this).attr("disabled","disabled"),$('.loader').addClass('active'),save(rowUid,adminViewModel).then(()=>{$(this).removeAttr("disabled"),$('.loader').removeClass('active')})):($('.notification').removeClass('d-hide').find('.text').text('Please, select user to edit'),setTimeout((function(){$('.notification').addClass('d-hide').find('.text').text('')}),2e3))})),$(document).on('click','#delete-editor',(function(e){e.preventDefault(),'undefined'!=typeof rowUid&&''!==rowUid?($(this).attr("disabled","disabled"),$('.loader').addClass('active'),function remove(id,adminViewModel){return adminViewModel.deleteEditor(id).then(()=>{$('.notification').removeClass('d-hide').find('.text').text(' The user was successfully deleted'),$('.grid-form input').val(''),setTimeout((function(){$('.notification').addClass('d-hide').find('.text').text('')}),4e3),this.activeRow.delete().then((function(){})).catch((function(error){}))}).catch((function(e){alert('Unable to delete user: '+e)}))}(rowUid,adminViewModel).then(()=>{$(this).removeAttr("disabled"),$('.loader').removeClass('active')})):($('.notification').removeClass('d-hide').find('.text').text('Please, select user to delete'),setTimeout((function(){$('.notification').addClass('d-hide').find('.text').text('')}),2e3))}))}));function save(id,adminViewModel){let password=$("#editor-form input[name='password']").val(),email=$("#editor-form input[name='email']").val(),name=$("#editor-form input[name='name']").val();if(void 0!==id&&''!==id){if(void 0===id||''===id||''===name)throw new Error("no user selected to edit");return adminViewModel.editEditor(id,name).then(documentRef=>{$('.notification').removeClass('d-hide').find('.text').text('user was successfully updated'),$('.grid-form input').val(''),setTimeout((function(){$('.notification').addClass('d-hide').find('.text').text('')}),4e3),this.table.updateOrAddData([{id,name}]).then((function(){})).catch((function(error){}))})}{if(''===email||''===password)throw $('.js-add-editor').removeAttr("disabled"),$('.loader').removeClass('active'),$('.notification').removeClass('d-hide').find('.text').text('User email and password can\'t be blank'),setTimeout((function(){$('.notification').addClass('d-hide').find('.text').text('')}),2e3),new Error("user data is empty");let guid=function getGUID(){var d=(new Date).getTime();'undefined'!=typeof performance&&'function'==typeof performance.now&&(d+=performance.now());return'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g,(function(c){var r=(d+16*Math.random())%16|0;return d=Math.floor(d/16),('x'===c?r:3&r|8).toString(16)}))}();return adminViewModel.addEditor(guid,name,email,password).then(documentRef=>{$('.notification').removeClass('d-hide').find('.text').text('new user was created'),$('.grid-form input').val(''),setTimeout((function(){$('.notification').addClass('d-hide').find('.text').text('')}),4e3),this.table.updateOrAddData([{id:guid,email,name}]).then((function(){})).catch((function(error){}))}).catch(err=>{void 0!==err&&alert("Unable to create user: "+err.errorMessage),$('.notification').removeClass('d-hide').addClass('error-msg').find('.text').text('an error occured, user wasn\'t created',err),setTimeout((function(){$('.notification').addClass('d-hide').removeClass('error-msg').find('.text').text('')}),4e3)})}}