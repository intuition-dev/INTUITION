// mB v6.08.2 on 2019-09-05T09:14:03.001Z
depp.define({adminViewModel:["../models/AdminViewModel.js"]}),depp.require("baseVm"),depp.require("adminViewModel"),depp.require(["ui","scripts","setup-page"],async function(){var e=await AdminViewModel.inst()
drawTable(e),$(document).on("click","#add-editor",function(t){t.preventDefault(),$(this).attr("disabled","disabled"),$(".loader").addClass("active"),save("",e).then(()=>{$(this).removeAttr("disabled"),$(".loader").removeClass("active")})}),$(document).find("#edit-editor").on("click",function(t){t.preventDefault(),"undefined"!=typeof rowUid&&""!==rowUid?($(this).attr("disabled","disabled"),$(".loader").addClass("active"),save(rowUid,e).then(()=>{$(this).removeAttr("disabled"),$(".loader").removeClass("active")})):($(".notification").removeClass("d-hide").find(".text").text("Please, select user to edit"),setTimeout(function(){$(".notification").addClass("d-hide").find(".text").text("")},2e3))}),$(document).on("click","#delete-editor",function(t){t.preventDefault(),"undefined"!=typeof rowUid&&""!==rowUid?($(this).attr("disabled","disabled"),$(".loader").addClass("active"),remove(rowUid,e).then(()=>{$(this).removeAttr("disabled"),$(".loader").removeClass("active")})):($(".notification").removeClass("d-hide").find(".text").text("Please, select user to delete"),setTimeout(function(){$(".notification").addClass("d-hide").find(".text").text("")},2e3))})})
var table=null,activeRow=null
function drawTable(e){e.getEditorsList().then(e=>{this.table=new Tabulator("#editors-table",{layout:"fitColumns",columns:[{title:"id",field:"id",visible:!1},{title:"Email",field:"email",align:"left"},{title:"Name",field:"name",align:"left"}],rowClick:(e,t)=>{this.activeRow=t
t=t.getData()
window.rowUid=t.id,$('input[name="name"]').val(t.name),$('input[name="email"], input[name="password"]').val("")}}),Array.isArray(e)?this.table.setData(e):window.location="/admin"}).then(this.initActionButtons)}function save(e,t){let i=$("#editor-form input[name='password']").val(),d=$("#editor-form input[name='email']").val(),a=$("#editor-form input[name='name']").val()
if(void 0!==e&&""!==e){if(void 0===e||""===e||""===a)throw new Error("no user selected to edit")
return t.editEditor(e,a).then(t=>{$(".notification").removeClass("d-hide").find(".text").text("user was successfully updated"),$(".grid-form input").val(""),setTimeout(function(){$(".notification").addClass("d-hide").find(".text").text("")},4e3),this.table.updateOrAddData([{id:e,name:a}]).then(function(){}).catch(function(e){})})}{if(""===d||""===i)throw $(".js-add-editor").removeAttr("disabled"),$(".loader").removeClass("active"),$(".notification").removeClass("d-hide").find(".text").text("User email and password can't be blank"),setTimeout(function(){$(".notification").addClass("d-hide").find(".text").text("")},2e3),new Error("user data is empty")
let e=getGUID()
return t.addEditor(e,a,d,i).then(t=>{$(".notification").removeClass("d-hide").find(".text").text("new user was created"),$(".grid-form input").val(""),setTimeout(function(){$(".notification").addClass("d-hide").find(".text").text("")},4e3),this.table.updateOrAddData([{id:e,email:d,name:a}]).then(function(){}).catch(function(e){})}).catch(e=>{void 0!==e&&alert("Unable to create user: "+e.errorMessage),$(".notification").removeClass("d-hide").addClass("error-msg").find(".text").text("an error occured, user wasn't created",e),setTimeout(function(){$(".notification").addClass("d-hide").removeClass("error-msg").find(".text").text("")},4e3)})}}function remove(e,t){return t.deleteEditor(e).then(()=>{$(".notification").removeClass("d-hide").find(".text").text(" The user was successfully deleted"),$(".grid-form input").val(""),setTimeout(function(){$(".notification").addClass("d-hide").find(".text").text("")},4e3),this.activeRow.delete().then(function(){}).catch(function(e){})}).catch(function(e){alert("Unable to delete user: "+e)})}