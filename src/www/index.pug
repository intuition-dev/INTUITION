extends layout/layout
block header
block content
	.login-bg
		.login-wrapper
			.login-form-wrap
				.login-form
					form#login-form.grid-form(action="#")
						fieldset
							legend 
								.site-brand Site Name
								| Admin CMS 
								
							.input-wrap
								label Login
								input(type='text', name='login', required='required')
							.input-wrap
								label Password
								input(type='password', name='password', required='required')
						#error.d-hide.isError
						button#btn-login.btn-custom.btn-primary.btn-center.space-21v Login

						p 	Get
							a.upper(href='/readme.md') Chrome extension
							
						p 
							span Not registered?
							a.upper(href='#') Visit WebAdmin Admin 
								|to create an account
						p
							a#reset-password-link(href='#') Forgot password?

					form#reset-password-form.grid-form.d-hide(action="#")
						fieldset
							legend Reset Password
							div.input-wrap
								label Enter your email address
								input(type='email', name='email', required='required')

						.message.message-info.d-hide
						.message.message-warning.d-hide

						button.btn-custom.btn-primary.btn-center.space-21v Reset
	script.
		depp.require(['rw'], function () {
			let login = new Login();

			/*
			* login user
			*/
			$(document).on('submit', '#login-form', function (e) {

				e.preventDefault();
				let formLogin = $("#login-form input[name='login']").val();
				let formPassw = $("#login-form input[name='password']").val();
				login.checkUser(formLogin, formPassw);

			});

			/*
			* reset password
			*/
			$(document).on('click', '#reset-password-link', function () {

				$('#reset-password-form').removeClass('d-hide');
				$('#login-form').addClass('d-hide');

			});

			$('#reset-password-form').submit(function (e) {

				e.preventDefault();

				$('[class^="message"]').addClass('d-hide');

				let email = $(this).find('input[type="email"]').val();

				auth.sendPasswordResetEmail(email)
					.then(() => {

						$(this).find('fieldset, button').addClass('d-hide');
						$(this).find('.message-info').removeClass('d-hide').text('An email with the password reset link has been sent to your email address');

						setTimeout(function () {

							$('#reset-password-form fieldset, #reset-password-form .btn-group, #login-form').removeClass('d-hide');
							$('#reset-password-form, #reset-password-form p').addClass('d-hide');

						}, 5000);

					})
					.catch(function (error) {

						console.info('email hasn\'t been sent to user', error);
						$('.message-warning').removeClass('d-hide').text('No user exists with such email');

					});

			});

		});