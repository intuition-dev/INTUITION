extends layout/layout
block header
block content
	.login-bg
		.login-wrapper
			.login-form-wrap
				.login-form
					form#login-form.js-login-form.grid-form(action="#")
						fieldset
							legend 
								.site-brand Site Name
								| Admin CMS 
								
							.input-wrap
								label Login
								input(type='text', name='login', required='required')
							.input-wrap
								label Password
								input(type='password', name='password', required='required')
						#error.d-hide.isError
						button#btn-login.js-btn-login.btn-custom.btn-primary.btn-center.space-21v Login

						p 	Get
							a.upper(href='/readme.md') Chrome extension
							
						p 
							span Not registered?
							a.upper(href='#') Visit IntuAPI Admin 
								|to create an account
						p
							a.reset-password(href='#', data="reset-password") Forgot password?

					form#reset-password.d-hide.grid-form(action="#", name='reset-pass-form')
						fieldset
							.input-wrap
								label Enter email
								input(type='email', name='reset-password-email', required='required')
						button.btn-custom.btn-primary.btn-center.space-21v(name="reset-password-btn", type='submit') Reset Password
					
					form#reset-password-2.d-hide.grid-form(action="#", name='reset-pass-form-2')
						fieldset
							.input-wrap
								label Enter new password
								input(type='password', name='new-password', required='required')
							.input-wrap.bl_v-code
								div.v-code Verification code was sent to your email
								label.bl_v-code__label Enter verification code
								input.bl_v-code__input(type='number', name='v-code', required='required')
						button.btn-custom.btn-primary.btn-center.space-21v(name="reset-password-btn-2", type='submit') Reset Password

					.bl_pass-changed-notification.d-hide.js-pass-changed-notification
						h1 Password changed
						p You can now sign in with your new password

					.bl_pass-changed-notification.bl_pass-changed-notification--err.d-hide.js-pass-changed-notification-err
						h1 Password hasn't been changed
						p Something went wrong
	
	script.
		depp.require(['rw'], function () {

			var bindLogin = new BindLogin();

			/*
			* editor user login
			*/
			$(document).on('submit', '#login-form', function (e) {

				e.preventDefault();
				let formLogin = $("#login-form input[name='login']").val();
				let formPassw = $("#login-form input[name='password']").val();
				bindLogin.checkUser(formLogin, formPassw);

			});

			/*
			* editor password reset
			*/
			$(document).on('click', '[data="reset-password"]', function (e) {
				e.preventDefault();
				$('#login-form, #btn-login, [data="reset-password"]').addClass('d-hide');
				$("[name='reset-pass-form']").removeClass('d-hide');
			});

			$(document).on('submit', '[name="reset-pass-form"]', function (e) {
				e.preventDefault();
				$("[name='reset-pass-form']").addClass('d-hide');
				$("[name='reset-pass-form-2']").removeClass('d-hide');
				window.resetEmail = $("[name='reset-password-email']").val();
				$('.v-code').html('Verification code was sent to ' + resetEmail);
				bindLogin.sendVcode(resetEmail);
			});

			let url = new URL(location.href);
			let urlEmail = url.searchParams.get("email");

			if (urlEmail !== null && urlEmail !== '') {

				$('#login-form, #btn-login, [data="reset-password"]').addClass('d-hide');
				$("[name='reset-pass-form-2']").removeClass('d-hide');
				$('.v-code').html('Verification code was sent to ' + urlEmail);
				bindLogin.sendVcode(urlEmail);

				$(document).on('submit', '[name="reset-pass-form-2"]', function (e) {
					e.preventDefault();
					$("[name='reset-pass-form-2']").addClass('d-hide');
					let password = $("[name='new-password']").val();
					let vCode = $("[name='v-code']").val();
					bindLogin.resetPass(urlEmail, vCode, password);
				});

			} else {

				$(document).on('submit', '[name="reset-pass-form-2"]', function (e) {
					e.preventDefault();
					$("[name='reset-pass-form-2']").addClass('d-hide');
					let password = $("[name='new-password']").val();
					let vCode = $("[name='v-code']").val();
					bindLogin.resetPass(resetEmail, vCode, password);
				});

			}

		});