// mB v6.08.2 on 2019-08-01T07:58:58.216Z
"use strict"
class Posts{constructor(){this.showDirs=this.showDirs.bind(this),this.showMd=this.showMd.bind(this),this.editViewModel=new EditViewModel}loadTextarea(){depp.define({codeEdit:["//cdn.jsdelivr.net/npm/codemirror@5.46.0/lib/codemirror.css","//cdn.jsdelivr.net/npm/codemirror@5.46.0/theme/solarized.css","//cdn.jsdelivr.net/npm/codemirror@5.46.0/lib/codemirror.min.js","//cdn.jsdelivr.net/npm/codemirror@5.46.0/mode/markdown/markdown.js","//cdn.jsdelivr.net/npm/codemirror@5.46.0/mode/yaml/yaml.js","//cdn.jsdelivr.net/npm/codemirror@5.46.0/mode/pug/pug.js","//cdn.jsdelivr.net/npm/codemirror@5.46.0/mode/css/css.js","//cdn.jsdelivr.net/npm/codemirror@5.46.0/keymap/sublime.js"]}),depp.require("codeEdit",this.pgInit.bind(this))}pgInit(){this._initCodeMirror()}_initCodeMirror(e){null!==window.myCodeMirror&&window.myCodeMirror.toTextArea(),window.myCodeMirror=CodeMirror.fromTextArea(document.querySelector("#cms1"),{mode:e||"markdown",lineNumbers:!0,tabSize:3,indentWithTabs:!1,v11iewportMargin:"Infinity",lineWrapping:!0}),window.myCodeMirror.setSize("100%","100%")}showDirs(e){let i=""
return this.editViewModel.getDirsList().then(e=>{Array.isArray(e)?(e.forEach(e=>{i+='<div class="blog-item"><i class="knot"><div></div></i><div class="d-flex"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 26 26" version="1.1" width="20px" height="20px"><g id="surface1"><path style=" " d="M 3 2 C 1.34375 2 0 3.34375 0 5 L 0 22 C 0 23.65625 1.34375 25 3 25 L 23 25 C 24.65625 25 26 23.65625 26 22 L 26 8 C 26 6.34375 24.65625 5 23 5 L 11 5 C 11 3.34375 9.65625 2 8 2 Z M 3 7 L 23 7 C 23.550781 7 24 7.449219 24 8 L 24 22 C 24 22.550781 23.550781 23 23 23 L 3 23 C 2.449219 23 2 22.550781 2 22 L 2 8 C 2 7.449219 2.449219 7 3 7 Z "/></g></svg><span>'+e+"</span></div></div>"}),$(".blog-list-wrap").append(i)):window.location="/edit"})}init(e){this.showDirs(e).then(()=>{if(void 0!==e&&""!==e){let i=$('.blog-item:contains("'+e+'")')
$(".blog-item ul").remove(),$(".upload, .i-plusCircle").removeClass("disabled"),$(".knot").removeClass("active"),$(i).find(".knot").addClass("active"),$(".blog-item").removeClass("active"),$(i).addClass("active"),$(".btn-custom.save").attr("disabled","disabled"),$(".js-view-page").removeAttr("disabled")
let t=$(i).find("span").text()
$(".js-view-page").attr("href",appMount+"/"+t),0===$(i).find("ul").length?this.showSubDirs(t):$(this).find("ul").remove()}})}showSubDirs(e){let i=""
return this.editViewModel.getSubDirsList(e).then(e=>{Array.isArray(e)?(e.forEach(e=>{i+='<li><div><i class="i-file"></i>'+e+"</div></li>"}),$(".blog-item.active").append("<ul>"+i+"</ul>")):window.location="/edit"}).then(()=>{$(".blog-item li").each(function(){let e=$(this).text()
e.includes(".md")&&$(this).addClass("md-highlight"),(e.includes(".md")||e.includes(".yaml")||e.includes(".css")||e.includes(".pug")||e.includes(".csv"))&&$(this).addClass("hover-highlight")})})}showMd(e,i){this.editViewModel.getFile(e,i).then(e=>{e?window.myCodeMirror.setValue(e):window.location="/edit"})}saveMd(e,i,t,s){return this.editViewModel.saveFile(e,i,t).then(e=>e).then(()=>{s.removeAttr("disabled"),$(".loader").removeClass("active"),$(".notification").removeClass("d-hide").find(".text").text("The content was successfully updated"),setTimeout(function(){$(".notification").addClass("d-hide").find(".text").text("")},2e3)}).then(()=>{this.compile(e,i,t).then(e=>{if("OK"==e){let e="Files have been built"
$('[data-js="errors"]').removeClass("toast-error d-hide").html(e),setTimeout(function(){$('[data-js="errors"]').addClass("d-hide toast-error").html("")},4e3)}else{var i=e.msg+" in "+e.filename+" at line "+e.line+"<br />"
$('[data-js="errors"]').html(i),$('[data-js="errors"]').removeClass("d-hide")}})})}compile(e,i,t){return this.editViewModel.mbakeCompile(e,i,t).then(e=>e)}addPost(e,i,t){return this.editViewModel.clonePage(e,i).then(()=>{t.removeAttr("disabled"),$(".loader").removeClass("active"),$(".notification").removeClass("d-hide").find(".text").text("New post was added, now you can edit the content"),setTimeout(function(){$(".notification").addClass("d-hide").find(".text").text("")},4e3),$(".post-name-wrap").addClass("d-hide").find("input").val(""),$(".create-post").removeClass("active")})}uploadFile(e,i,t,s){var d=new FormData
return d.append("sampleFile",e),this.editViewModel.upload(d,i).then(()=>{t.removeAttr("disabled"),$(".loader").removeClass("active"),$(".file-upload").addClass("d-hide"),$(".notification").removeClass("d-hide").find(".text").text("The file was successfully uploaded to the folder "+s),setTimeout(function(){$(".notification").addClass("d-hide").find(".text").text(""),$('.file-upload input[type="file"]').val("")},4e3)})}setPublishDate(e,i){return this.editViewModel.setPublishDate(e,i).then(()=>{$(this).find("button").removeAttr("disabled"),$(".loader").removeClass("active"),$(".publish-date-form").addClass("d-hide"),$(".notification").removeClass("d-hide").find(".text").text("Publish date was successfully set for post "+i),setTimeout(function(){$(".notification").addClass("d-hide").find(".text").text("")},4e3)})}refresh(e,i){this.showDirs().then(()=>{$(".blog-list-wrap").find(".blog-item span:contains("+e+")").parents(".blog-item").addClass("active").click().find("ul li:contains("+i+")").addClass("active").click(),setTimeout(function(){$(".blog-item.active ul li:contains("+i+")").addClass("active").click(),$(".loader").removeClass("active")},1e3)})}refreshClosed(){this.showDirs().then(()=>$(".loader").removeClass("active"))}refreshTextarea(e,i){if(e.includes(".md")||e.includes("dat.yaml")||e.includes("GLO.yaml")||e.includes(".csv")||e.includes(".css")){switch(!0){case e.includes(".md"):this._initCodeMirror("markdown")
break
case e.includes("dat.yaml"):case e.includes("GLO.yaml"):this._initCodeMirror("yaml")
break
case e.includes(".csv"):this._initCodeMirror("csv")
break
case e.includes(".css"):case e.includes(".css"):this._initCodeMirror("css")
break
default:this._initCodeMirror("text")}$(".blog-item li").removeClass("active"),i.addClass("active")
let t=i.parents(".blog-item").find("span").text(),s=e.replace("/","")
$(".js-file-name").text(s),this.showMd(e,t),$(".btn-custom.save").removeAttr("disabled"),$(".i-calendar").addClass("disabled"),e.includes("dat.yaml")&&$(".i-calendar").removeClass("disabled")}}enablePug(){this._initCodeMirror("pug")}refreshDirsOnClone(e){this.showDirs().then(()=>{$(".blog-list-wrap").find(".blog-item span:contains("+e+")").parents(".blog-item").addClass("active").click().find("ul li:contains('.md')").addClass("active").click(),setTimeout(function(){$(".blog-item.active ul li:contains('.md')").addClass("active").click()},1e3)})}refreshOnUpload(e,i){this.showDirs().then(()=>{$(".blog-list-wrap").find(".blog-item span:contains("+e+")").parents(".blog-item").addClass("active").click().find("ul li:contains("+i+")").addClass("active").click(),setTimeout(function(){$(".blog-item.active ul li:contains("+i+")").addClass("active").click()},1e3),window.myCodeMirror.setValue("")})}refreshOnSetDate(e){this.showDirs().then(()=>{$(".blog-list-wrap").find(".blog-item span:contains("+e+")").parents(".blog-item").addClass("active").click().find("ul li:contains('.md')").addClass("active").click(),setTimeout(function(){$(".blog-item.active ul li:contains('dat.yaml')").addClass("active").click()},1e3),window.myCodeMirror.setValue("")})}signOut(){sessionStorage.clear(),window.location="/edit"}}