// mB v5.07.08 on 2019-06-24T11:08:02.291Z
"use strict"
Object.defineProperty(exports,"__esModule",{value:!0})
var request=require("request")
function init(e,t,i){e.post("/api/shipping/"+t,function(e,r){var n=e.fields.mode,s=e.fields,a={},o=s.content.shippingAddress,u=s.content.items,p={}
p.name=o.fullName,p.address1=o.address1,p.city=o.city,p.country_code=o.country,p.state_code=o.province,p.zip=o.postalCode
var c=[]
"Live"==n?(a.type="",a.ispacked=!1,i.getPrintfulAPI().then(function(e){var i=e[0].printfulApi
if("printful-rate"==t){u.map(function(e){var t={}
t.quantity=e.quantity,t.variant_id=e.metadata.rate_id,c.push(t)})
var n=Object.assign({recipient:p,items:c})
request({url:"https://api.printful.com/shipping/rates",headers:{Authorization:"Basic "+i},method:"POST",json:n},function(e,t,i){r.json({rates:[{cost:1,description:"1$ shipping"}]})})}if("printful-create-order"==t&&"order.completed"==s.eventName){u.map(function(e){var t={}
t.quantity=e.quantity,t.sync_variant_id=e.id,c.push(t)})
n=Object.assign({recipient:p,items:c})
request({url:"https://api.printful.com/orders",headers:{Authorization:"Basic "+i},method:"POST",json:n},function(e,t,i){r.json(i)})}}).catch(function(e){return a.errorLevel=-1,a.errorMessage=e,a.result=!1,r.json(a)})):(a.errorLevel=-1,a.errorMessage="mismatch",r.json(a))})}exports.init=init,module.exports={init:init}